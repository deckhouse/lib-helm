suite: helm_lib_module_storage_class_test definition
templates:
  - helm_lib_module_storage_class.yaml
tests:
  - it: should not contain default storage class annotation if no discovery.defaultStorageClass is set

    set:
      global:
        discovery:
          defaultStorageClass: ""

    asserts:
      - equal:
          path: annotations
          value: {}

  - it: should contain default storage class annotation

    set:
      global:
        discovery:
          # set as in tests/templates/helm_lib_module_storage_class.yaml
          defaultStorageClass: "cloud-provider-storageclass"

    asserts:
      - equal:
          path: annotations["storageclass.kubernetes.io/is-default-class"]
          value: "true"

  # - it: should failed to render without "%s" pattern

  #   set:
  #     prefix: test
  #     global:
  #       modules:
  #         publicDomainTemplate: .com

  #   asserts:
  #     - failedTemplate:
  #         errorMessage: 'Error!!! global.modules.publicDomainTemplate must contain "%s" pattern to render service fqdn!'
