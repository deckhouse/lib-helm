suite: test helm_lib_prometheus_rules_recursion with filter
templates:
  - helm_lib_prometheus_rules_recursion-filter.yaml
tests:
  - it: should render only specified PrometheusRule
    set:
      global.enabledModules: ["observability"]
      global.discovery.prometheusScrapeInterval: 30s
      global.discovery.apiVersions: []
    asserts:
      - equal:
          path: kind
          value: PrometheusRule
      - equal:
          path: metadata.name
          value: test-module-livebeef-propagated-caps
      - hasDocuments:
          count: 1
