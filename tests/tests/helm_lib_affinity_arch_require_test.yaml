suite: helm_lib_affinity_arch_require definition
templates:
  - helm_lib_affinity_arch_require.yaml
tests:
  - it: should render node affinity for allowed architectures
    set:
      Chart:
        Name: "testModule"
    asserts:
      - notEqual:
          path: resultDefault
          value: ""
      - matchRegex:
          path: resultDefault
          pattern: "nodeAffinity"
      - matchRegex:
          path: resultDefault
          pattern: "kubernetes.io/arch"
      - matchRegex:
          path: resultDefault
          pattern: "operator:\\s*In"
      - notMatchRegex:
          path: resultDefault
          pattern: "operator:\\s*NotIn"
      - matchRegex:
          path: resultDefault
          pattern: "- \\\"arm\\\""
      - matchRegex:
          path: resultDefault
          pattern: "- \\\"arm64\\\""
  - it: should allow overriding architectures list
    set:
      Chart:
        Name: "testModule"
    asserts:
      - matchRegex:
          path: resultCustom
          pattern: "operator:\\s*In"
      - notMatchRegex:
          path: resultCustom
          pattern: "operator:\\s*NotIn"
      - matchRegex:
          path: resultCustom
          pattern: "- \\\"amd64\\\""
      - matchRegex:
          path: resultCustom
          pattern: "- \\\"ppc64le\\\""
      - notMatchRegex:
          path: resultCustom
          pattern: "\\\"arm\\\""
