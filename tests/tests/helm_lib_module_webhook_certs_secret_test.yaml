suite: helm_lib_module_webhook_certs_secret definition
templates:
  - helm_lib_module_webhook_certs_secret.yaml
tests:
  - it: renders webhook certs secret with defaults
    set:
      testModule:
        internal:
          customWebhookCert:
            ca: my-ca-certificate
            crt: my-tls-certificate
            key: my-tls-key
      _testvalues:
        valuesKey: testModule
        webhookCertPath: internal.customWebhookCert

    asserts:
      - containsDocument:
          kind: Secret
          apiVersion: v1
          name: webhooks-https-certs
          namespace: d8-test-module

      - equal:
          path: type
          value: kubernetes.io/tls

      - equal:
          path: data["ca.crt"]
          value: bXktY2EtY2VydGlmaWNhdGU=

      - equal:
          path: data["tls.crt"]
          value: bXktdGxzLWNlcnRpZmljYXRl

      - equal:
          path: data["tls.key"]
          value: bXktdGxzLWtleQ==

  - it: renders webhook certs secret with custom fullname
    set:
      testModule:
        internal:
          customWebhookCert:
            ca: ca
            crt: crt
            key: key
      _testvalues:
        valuesKey: testModule
        webhookCertPath: internal.customWebhookCert
        fullname: custom-certs

    asserts:
      - containsDocument:
          kind: Secret
          apiVersion: v1
          name: custom-certs
          namespace: d8-test-module

  - it: renders webhook certs secret with custom app label
    set:
      testModule:
        internal:
          customWebhookCert:
            ca: ca
            crt: crt
            key: key
      _testvalues:
        valuesKey: testModule
        webhookCertPath: internal.customWebhookCert
        appLabel: my-app

    asserts:
      - equal:
          path: metadata.labels.app
          value: my-app
